{% extends 'base.html' %}

{% block title %}Insights - Pradolux{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h2 class="display-6 fw-bold text-pradolux">Insights de Faturamento</h2>
        <p class="text-muted">Acompanhe a evolução das vendas mês a mês.</p>
    </div>
    <div class="col-auto">
        <a href="{{ url_for('menu') }}" class="btn btn-outline-secondary">Voltar ao Menu</a>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-body">
        <canvas id="salesChart" width="400" height="150"></canvas>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var ctx = document.getElementById('salesChart').getContext('2d');
        var salesChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: {{ labels | tojson }},
        datasets: [{
            label: 'Faturamento Mensal (R$)',
            data: {{ values | tojson }},
        backgroundColor: 'rgba(54, 162, 235, 0.5)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
                }]
            },
        options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'top',
            },
            tooltip: {
                callbacks: {
                    label: function (context) {
                        let label = context.dataset.label || '';
                        if (label) {
                            label += ': ';
                        }
                        if (context.parsed.y !== null) {
                            label += new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(context.parsed.y);
                        }
                        return label;
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function (value, index, values) {
                        return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumSignificantDigits: 3 }).format(value);
                    }
                }
            }
        }
    }
        });
    });
</script>
{% endblock %}