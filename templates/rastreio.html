{% extends 'base.html' %}

{% block title %}Pedidos - Pradolux{% endblock %}

{% block container_class %}container-fluid px-2 px-md-4{% endblock %}

{% block content %}

<div class="row mb-4">
    <div class="col">
        <h2>Pedidos</h2>
        <p class="text-muted">Acompanhe o status dos seus pedidos</p>
    </div>
    <div class="col-auto">
        <a href="{{ url_for('menu') }}" class="btn btn-outline-secondary">Voltar</a>
    </div>
</div>

<!-- <div class="card mb-4">
    <div class="card-body">
        <form method="get" action="{{ url_for('rastreio') }}" class="row g-3 align-items-end">
            <div class="col-md-3">
                <label for="start_date" class="form-label">Data Inicial</label>
                <input type="date" class="form-control" id="start_date" name="start_date" value="{{ start_date }}">
            </div>
            <div class="col-md-3">
                <label for="end_date" class="form-label">Data Final</label>
                <input type="date" class="form-control" id="end_date" name="end_date" value="{{ end_date }}">
            </div>
            <div class="col-md-3">
                <label for="order_number" class="form-label">Número do Pedido</label>
                <input type="text" class="form-control" id="order_number" name="order_number" value="{{ order_number }}"
                    placeholder="Ex: 12345">
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100">Filtrar</button>
            </div>
        </form>
    </div>
</div> -->

<style>
    /* Kanban Flow / Evolution Styles */
    .kanban-col {
        position: relative;
        padding-right: 10px;
        padding-left: 10px;
        flex: 0 0 300px;
        /* Fixed width for columns */
        max-width: 300px;
    }

    .chevron-header {
        position: relative;
        padding: 15px;
        color: white;
        font-weight: bold;
        text-align: center;
        margin-bottom: 15px;
        clip-path: polygon(0% 0%, 90% 0%, 100% 50%, 90% 100%, 0% 100%, 10% 50%);
        /* Arrow shape */
        border-radius: 4px;
        /* Slight roundness */
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        text-transform: uppercase;
        font-size: 0.8rem;
        display: flex;
        /* Centering content properly */
        align-items: center;
        justify-content: center;
        min-height: 50px;
    }

    /* Colors for each step */
    .step-1 {
        background: #6c757d;
    }

    /* Gray - Comercial */
    .step-2 {
        background: #ffc107;
        color: #212529;
    }

    /* Warning - Produção */
    .step-3 {
        background: #0dcaf0;
    }

    /* Info - Separação */
    .step-4 {
        background: #0d6efd;
    }

    /* Primary - Conferência */
    .step-5 {
        background: #6610f2;
    }

    /* Indigo - Em Faturamento */
    .step-6 {
        background: #198754;
    }

    /* Success - Faturado */

    .orders-container {
        scrollbar-width: thin;
        scrollbar-color: #dee2e6 #f8f9fa;
    }

    .order-card {
        transition: transform 0.2s, box-shadow 0.2s;
        border: none;
        border-left: 4px solid transparent;
        background: white;
        width: 100%;
        /* Fill the column */
        min-height: 110px;
    }

    .order-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1) !important;
    }

    .order-card.step-1-border {
        border-left-color: #6c757d;
    }

    .order-card.step-2-border {
        border-left-color: #ffc107;
    }

    .order-card.step-3-border {
        border-left-color: #0dcaf0;
    }

    .order-card.step-4-border {
        border-left-color: #0d6efd;
    }

    .order-card.step-5-border {
        border-left-color: #6610f2;
    }

    .order-card.step-6-border {
        border-left-color: #198754;
    }

    .card-text.city-text {
        font-size: 0.7rem;
        color: #6c757d;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .card-text.value-text {
        font-weight: 600;
        color: #212529;
    }
</style>

<div class="overflow-auto pb-3 orders-container"> <!-- Wrapper for scroll -->
    <div class="row flex-nowrap g-1" style="min-width: max-content; margin: 0;">
        <!-- Row with min-width to ensure scrolling -->

        <!-- Coluna Comercial (Step 1) -->
        <div class="col-auto kanban-col">
            <div class="chevron-header step-1">
                1. Comercial ({{ kanban_data['Comercial']|length }})
            </div>
            <div class="overflow-auto" style="max-height: 70vh;">
                {% for item in kanban_data['Comercial'] %}
                <div class="card mb-3 shadow-sm order-card step-1-border">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="card-title fw-bold text-secondary mb-0">#{{ item.NumeroPedido }}</h6>
                            <small class="text-muted" style="font-size: 0.75rem;">{{ item.Emissao|format_date_br
                                }}</small>
                        </div>
                        <p class="card-text small mb-1 fw-bold text-truncate">{{ item.Cliente }}</p>
                        <p class="card-text city-text mb-2"><i class="bi bi-geo-alt"></i> {{ item.Cidade }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="card-text small value-text">{{ item.Valor|format_currency_br }}</span>
                            <small class="text-muted" style="font-size: 0.7rem;">Prev: {{
                                item.PrevisaoFaturamento|format_date_br }}</small>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Coluna Produção (Step 2) -->
        <div class="col-auto kanban-col">
            <div class="chevron-header step-2">
                2. Produção ({{ kanban_data['Produção']|length }})
            </div>
            <div class="overflow-auto" style="max-height: 70vh;">
                {% for item in kanban_data['Produção'] %}
                <div class="card mb-3 shadow-sm order-card step-2-border">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="card-title fw-bold text-warning mb-0" style="filter: brightness(0.85);">#{{
                                item.NumeroPedido }}</h6>
                            <small class="text-muted" style="font-size: 0.75rem;">{{ item.Emissao|format_date_br
                                }}</small>
                        </div>
                        <p class="card-text small mb-1 fw-bold text-truncate">{{ item.Cliente }}</p>
                        <p class="card-text city-text mb-2"><i class="bi bi-geo-alt"></i> {{ item.Cidade }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="card-text small value-text">{{ item.Valor|format_currency_br }}</span>
                            <small class="text-muted" style="font-size: 0.7rem;">Prev: {{
                                item.PrevisaoFaturamento|format_date_br }}</small>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Coluna Separação (Step 3) -->
        <div class="col-auto kanban-col">
            <div class="chevron-header step-3">
                3. Separação ({{ kanban_data['Separação']|length }})
            </div>
            <div class="overflow-auto" style="max-height: 70vh;">
                {% for item in kanban_data['Separação'] %}
                <div class="card mb-3 shadow-sm order-card step-3-border">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="card-title fw-bold text-info mb-0" style="filter: brightness(0.85);">#{{
                                item.NumeroPedido }}</h6>
                            <small class="text-muted" style="font-size: 0.75rem;">{{ item.Emissao|format_date_br
                                }}</small>
                        </div>
                        <p class="card-text small mb-1 fw-bold text-truncate">{{ item.Cliente }}</p>
                        <p class="card-text city-text mb-2"><i class="bi bi-geo-alt"></i> {{ item.Cidade }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="card-text small value-text">{{ item.Valor|format_currency_br }}</span>
                            <small class="text-muted" style="font-size: 0.7rem;">Prev: {{
                                item.PrevisaoFaturamento|format_date_br }}</small>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Coluna Conferência (Step 4) -->
        <div class="col-auto kanban-col">
            <div class="chevron-header step-4">
                4. Conferência ({{ kanban_data['Conferência']|length }})
            </div>
            <div class="overflow-auto" style="max-height: 70vh;">
                {% for item in kanban_data['Conferência'] %}
                <div class="card mb-3 shadow-sm order-card step-4-border">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="card-title fw-bold text-primary mb-0">#{{ item.NumeroPedido }}</h6>
                            <small class="text-muted" style="font-size: 0.75rem;">{{ item.Emissao|format_date_br
                                }}</small>
                        </div>
                        <p class="card-text small mb-1 fw-bold text-truncate">{{ item.Cliente }}</p>
                        <p class="card-text city-text mb-2"><i class="bi bi-geo-alt"></i> {{ item.Cidade }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="card-text small value-text">{{ item.Valor|format_currency_br }}</span>
                            <small class="text-muted" style="font-size: 0.7rem;">Prev: {{
                                item.PrevisaoFaturamento|format_date_br }}</small>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Coluna Em Faturamento (Step 5) -->
        <div class="col-auto kanban-col">
            <div class="chevron-header step-5">
                5. Em Faturamento ({{ kanban_data['Em Faturamento']|length }})
            </div>
            <div class="overflow-auto" style="max-height: 70vh;">
                {% for item in kanban_data['Em Faturamento'] %}
                <div class="card mb-3 shadow-sm order-card step-5-border">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="card-title fw-bold mb-0" style="color: #6610f2;">#{{ item.NumeroPedido }}</h6>
                            <small class="text-muted" style="font-size: 0.75rem;">{{ item.Emissao|format_date_br
                                }}</small>
                        </div>
                        <p class="card-text small mb-1 fw-bold text-truncate">{{ item.Cliente }}</p>
                        <p class="card-text city-text mb-2"><i class="bi bi-geo-alt"></i> {{ item.Cidade }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="card-text small value-text">{{ item.Valor|format_currency_br }}</span>
                            <small class="text-muted" style="font-size: 0.7rem;">Prev: {{
                                item.PrevisaoFaturamento|format_date_br }}</small>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Coluna Faturado (Step 6) -->
        <div class="col-auto kanban-col">
            <div class="chevron-header step-6">
                6. Faturado ({{ kanban_data['Faturado']|length }})
            </div>
            <div class="overflow-auto" style="max-height: 70vh;">
                {% for item in kanban_data['Faturado'] %}
                <div class="card mb-3 shadow-sm order-card step-6-border">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="card-title fw-bold text-success mb-0">#{{ item.NumeroPedido }}</h6>
                            <small class="text-muted" style="font-size: 0.75rem;">{{ item.Emissao|format_date_br
                                }}</small>
                        </div>
                        <p class="card-text small mb-1 fw-bold text-truncate">{{ item.Cliente }}</p>
                        <p class="card-text city-text mb-2"><i class="bi bi-geo-alt"></i> {{ item.Cidade }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="card-text small value-text">{{ item.Valor|format_currency_br }}</span>
                            <span class="badge bg-success rounded-pill px-2" style="font-size: 0.65rem;">Faturado</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

    </div>
</div>

{% endblock %}