<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,height=device-height, initial-scale=0.75" />
  <link rel="stylesheet" href="../static/login.css" />
  <!-- Bootstrap & Icones  -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <!--  -->
  <title>Login - Pradolux Industria LTDA</title>
</head>

<body>
  <div class="page-full d-flex row">
    <div class="d-flex col-8 bgImage d-none d-md-block">
      <div class="text-light col-6 m-5 w-75 h-50 d-flex flex-column justify-content-center">
        <div class="z-3 d-flex flex-column justify-content-start pt-5">
          <h1>Boas vindas ao Eng.testes!</h1>
          <h3>Sua plataforma de cálculos de Fotometria</h3>
        </div>
      </div>
    </div>
    <div class="d-flex flex-column col-12 col-md-4 align-items-center justify-content-center">
      <div class="mb-5">
        <img src="../static/src/img/NovoLogoPradolux.png" class="img-logo" />
      </div>
      <form class="d-flex flex-column w-75 align-items-center justify-content-center" action="{{ url_for('login') }}"
        method="post">
        <label class="w-100 fw-bold mb-3 ms-2">Usuário:</label>
        <div class="input-group input-group-lg mb-3">
          <span class="input-group-text text-dark-50" id="inputGroup-sizing-lg"><i class="bi bi-at"></i></span>
          <input class="form-control border border-2 border-dark-50" type="text" id="login" name="username"
            placeholder="Usuário" aria-describedby="inputGroup-sizing-lg" required />
        </div>
        <label class="w-100 fw-bold mb-3 ms-2">Senha:</label>
        <div class="input-group input-group-lg mb-3">
          <span class="input-group-text text-dark-subtle" id="inputGroup-sizing-lg"><i class="bi bi-lock"></i></span>
          <input class="form-control border border-2 border-dark-50" type="password" id="pass" name="password"
            placeholder="Senha" required />
        </div>
        <div class="form-check w-100">
          <input class="form-check-input" type="checkbox" value="" id="rememberMe" />
          <label class="form-check-label" for="flexCheckDefault"> Lembre-se de Mim </label>
        </div>
        <button class="w-100 btn btn-primary" type="submit">Entrar</button>
        <a href="" class="text-bold mt-5 mb-3">Esqueceu sua senha?</a>
        <div class="d-flex flex-column justify-content-center text-center">
          <span>Caso ainda encontre problemas para iniciar a sua sessão</span>
          <a href="">entre em contato com o administrador</a>
        </div>
      </form>
    </div>
  </div>
</body>

</html>

<script>
  window.onload = function () {
    const rememberMe = localStorage.getItem("@rmb");
    if (rememberMe === "true") {
      document.getElementById("login").value = localStorage.getItem("@unm");
      document.getElementById("rememberMe").checked = true;
      document.getElementById("pass").focus();
    }
  };

  document.querySelector("form").addEventListener("submit", async (e) => {
    e.preventDefault(); // Evita o reload da página

    const rememberCheck = document.getElementById("rememberMe");
    if (!rememberCheck.checked) {
      //Salva os dados do usuario no localStorage
      localStorage.setItem("@unm", "");
      localStorage.setItem("@rmb", "");
    }

    const form = e.target;
    const formData = new FormData(form);

    try {
      const response = await fetch(form.action, {
        method: form.method,
        body: formData,
      });

      if (response.status === 401) {
        // Captura o erro 401 e exibe a mensagem de erro
        const errorMsg = document.querySelector(".alert");
        if (errorMsg) {
          errorMsg.textContent = "⚠️ Usuário ou senha incorretos!";
          errorMsg.style.display = "block";
        } else {
          const div = document.createElement("div");
          div.classList.add("alert", "alert-danger", "mt-3");
          div.textContent = "⚠️ Usuário ou senha incorretos!";
          form.appendChild(div);
        }
      } else if (response.ok) {
        if (rememberCheck.checked) {
          //Salva os dados do usuario no localStorage
          localStorage.setItem("@unm", document.getElementById("login").value);
          localStorage.setItem("@rmb", document.getElementById("rememberMe").checked);
        }
        // Se o login deu certo, redireciona para o dashboard
        window.location.href = response.url;
      }
    } catch (error) {
      console.error("Erro na requisição:", error);
    }
  });
</script>